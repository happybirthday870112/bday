<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yoshi's Birthday Adventure</title>
    <style>
        /* --- ÂÖ®Â±ÄË®≠ÂÆö --- */
        body {
            margin: 0;
            padding: 0;
            background-color: #f0f8ff;
            font-family: 'Arial', sans-serif;
            overflow: hidden; /* Á¶ÅÊ≠¢Êç≤Âãï */
            touch-action: none; /* Á¶ÅÊ≠¢È†êË®≠Ëß∏ÊéßË°åÁÇ∫ */
            user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #333;
        }

        #game-container {
            width: 100%;
            height: 100%;
            max-width: 500px; /* ÊâãÊ©üÊØî‰æãÈôêÂà∂ */
            background: linear-gradient(to bottom, #87CEEB, #E0F6FF);
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* --- UI ‰ªãÈù¢ --- */
        .ui-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            background: rgba(255, 255, 255, 0.9);
            text-align: center;
            transition: opacity 0.5s;
        }

        .hidden {
            display: none !important;
        }

        h1 { color: #4CAF50; margin-bottom: 20px; font-size: 24px; }
        p { font-size: 18px; margin-bottom: 30px; line-height: 1.5; padding: 0 20px;}
        
        .btn {
            background: #76c7c0;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 20px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px #5a9e98;
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }

        /* --- ÈÄ≤Â∫¶ÂÑÄË°®Êùø --- */
        .egg-collection {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .egg-slot {
            width: 30px;
            height: 40px;
            border: 2px dashed #ccc;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            background: rgba(255,255,255,0.5);
        }
        .egg-slot.collected {
            background: #fff;
            border: 2px solid #4CAF50;
        }
        .egg-slot.collected::after {
            content: 'ü•ö';
            font-size: 24px;
        }

        /* --- CSS Âπæ‰ΩïËÄÄË•øÁπ™Ë£Ω --- */
        .yoshi {
            position: absolute;
            width: 60px;
            height: 60px;
            z-index: 10;
            transition: transform 0.1s;
        }
        .yoshi-head {
            position: absolute;
            width: 35px;
            height: 35px;
            background: #4CAF50;
            border-radius: 50%;
            top: 0;
            left: 10px;
            z-index: 2;
        }
        .yoshi-nose {
            position: absolute;
            width: 30px;
            height: 25px;
            background: #4CAF50;
            border-radius: 50%;
            top: 5px;
            right: -5px;
            z-index: 2;
        }
        .yoshi-body {
            position: absolute;
            width: 25px;
            height: 30px;
            background: #4CAF50;
            border-radius: 40%;
            top: 25px;
            left: 10px;
            z-index: 1;
        }
        .yoshi-cheek {
            position: absolute;
            width: 15px;
            height: 12px;
            background: white;
            border-radius: 50%;
            top: 20px;
            left: 20px;
            z-index: 3;
        }
        .yoshi-shell {
            position: absolute;
            width: 15px;
            height: 15px;
            background: #F44336;
            border-radius: 50%;
            top: 30px;
            left: 5px;
            z-index: 0;
        }
        .yoshi-boots {
            position: absolute;
            width: 20px;
            height: 12px;
            background: #FF9800;
            border-radius: 10px;
            bottom: 0;
            left: 15px;
            z-index: 1;
        }

        /* --- ÈÅäÊà≤ÂÖÉÁ¥†Ê®£Âºè --- */
        .game-object { position: absolute; }
        
        /* Game 1: Jump */
        .obstacle { background: #555; width: 30px; height: 30px; bottom: 0; clip-path: polygon(50% 0%, 0% 100%, 100% 100%); }
        .ground { position: absolute; bottom: 0; width: 100%; height: 20px; background: #8B4513; }
        
        /* Game 2: Melon Catch */
        .melon { width: 30px; height: 30px; background: #90EE90; border-radius: 50%; border: 2px solid #2E8B57; }
        .melon::after { content:''; position:absolute; width:100%; height:2px; background:#2E8B57; top:50%; }
        .bomb { width: 30px; height: 30px; background: #333; border-radius: 50%; }
        .bomb::before { content:'üí£'; position: absolute; top:-5px; left:2px; font-size:20px; color:white; }

        /* Game 3: Tongue Shot */
        .shy-guy { width: 40px; height: 40px; background: #F44336; border-radius: 5px; }
        .shy-guy::after { content:'xx'; color:white; font-family:monospace; position:absolute; top:10px; left:10px; font-weight:bold;}
        .tongue { height: 5px; background: #FF69B4; transform-origin: left center; position: absolute; }

        /* Game 4: Egg Laying */
        .big-egg { width: 100px; height: 130px; background: white; border: 5px solid #4CAF50; border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; position: relative; cursor: pointer; transition: transform 0.05s;}
        .big-egg::after { content: ''; position: absolute; width: 20px; height: 20px; background: #4CAF50; border-radius: 50%; top: 30px; left: 20px; }
        
        /* Game 5: Color Match */
        .basket { width: 100px; height: 50px; position: absolute; bottom: 20px; border-radius: 0 0 10px 10px; opacity: 0.8; text-align: center; line-height: 50px; font-weight: bold; color: white;}
        .basket-left { left: 20px; background: #F44336; }
        .basket-right { right: 20px; background: #4CAF50; }

        /* Game 6: Stop Go */
        .bowser { width: 80px; height: 80px; position: absolute; top: 20px; right: 20px; background: #FFC107; border-radius: 10px; border: 3px solid #333; transition: background 0.2s;}
        .bowser.angry { background: #F44336; } /* Back turned vs Looking */

        /* --- ËõãÁ≥ïËàáÊÖ∂Á•ùÈ†ÅÈù¢ --- */
        #cake-scene {
            background: #FFE4E1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .cake-container {
            position: relative;
            margin-top: 50px;
        }
        .cake-base {
            width: 200px;
            height: 100px;
            background: #FFF;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 5px #ddd;
        }
        .cake-spot {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #4CAF50;
            border-radius: 50%;
        }
        .candle {
            width: 10px;
            height: 40px;
            background: #FF9800;
            position: absolute;
            top: -40px;
            left: 95px;
        }
        .flame {
            width: 10px;
            height: 15px;
            background: #FF5722;
            border-radius: 50% 50% 20% 20%;
            position: absolute;
            top: -15px;
            animation: flicker 0.5s infinite alternate;
        }
        @keyframes flicker { from { transform: scale(1); opacity: 1; } to { transform: scale(1.1); opacity: 0.8; } }
        
        .message-jp {
            font-size: 28px;
            color: #E91E63;
            font-weight: bold;
            margin-top: 30px;
            text-shadow: 2px 2px #fff;
            animation: popIn 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }

    </style>
</head>
<body>

    <div id="game-container">
        <div id="game-canvas" style="position: relative; width: 100%; height: 100%;"></div>

        <div id="ui-layer" class="ui-screen">
            <h1 id="ui-title">ËºâÂÖ•‰∏≠...</h1>
            <div id="egg-display" class="egg-collection hidden">
                <div class="egg-slot" id="slot-1">1</div>
                <div class="egg-slot" id="slot-2">2</div>
                <div class="egg-slot" id="slot-3">3</div>
                <div class="egg-slot" id="slot-4">4</div>
                <div class="egg-slot" id="slot-5">5</div>
                <div class="egg-slot" id="slot-6">6</div>
            </div>
            <p id="ui-desc">Ë´ãÁ®çÂÄô</p>
            <button id="ui-btn" class="btn">ÈñãÂßã</button>
        </div>
    </div>

    <script>
        // --- Ê†∏ÂøÉÈÇèËºØ ---
        const urlParams = new URLSearchParams(window.location.search);
        const gameId = parseInt(urlParams.get('game')); // ÂèñÂæóÁ∂≤ÂùÄ‰∏äÁöÑ ?game=X
        const uiLayer = document.getElementById('ui-layer');
        const uiTitle = document.getElementById('ui-title');
        const uiDesc = document.getElementById('ui-desc');
        const uiBtn = document.getElementById('ui-btn');
        const eggDisplay = document.getElementById('egg-display');
        const canvas = document.getElementById('game-canvas');

        let isGameOver = false;
        let score = 0;
        let gameLoopId;

        // ÂàùÂßãÂåñ
        function init() {
            loadProgress();
            
            if (!gameId) {
                // Ê≤íÊúâÂèÉÊï∏ÔºåÈ°ØÁ§∫ÈÄ≤Â∫¶È†ÅÈù¢
                showDashboard();
            } else if (gameId >= 1 && gameId <= 6) {
                // ÊúâÂèÉÊï∏ÔºåÊ∫ñÂÇôÈÄ≤ÂÖ•Â∞çÊáâÁöÑÂ∞èÈÅäÊà≤
                showGameIntro(gameId);
            } else {
                alert("ÁÑ°ÊïàÁöÑÈÅäÊà≤‰ª£Á¢º");
            }
        }

        // ËÆÄÂèñÈÄ≤Â∫¶
        function loadProgress() {
            for (let i = 1; i <= 6; i++) {
                if (localStorage.getItem('yoshi_game_' + i)) {
                    const slot = document.getElementById('slot-' + i);
                    if(slot) slot.classList.add('collected');
                }
            }
            checkAllClear();
        }

        // Ê™¢Êü•ÊòØÂê¶ÂÖ®Á†¥
        function checkAllClear() {
            let cleared = 0;
            for (let i = 1; i <= 6; i++) {
                if (localStorage.getItem('yoshi_game_' + i)) cleared++;
            }
            return cleared === 6;
        }

        // È°ØÁ§∫Á∏ΩÈÄ≤Â∫¶Êùø
        function showDashboard() {
            uiTitle.innerText = "ËÄÄË•øÁöÑÁîüÊó•Â§ßÂÜíÈö™";
            uiDesc.innerText = checkAllClear() 
                ? "ÊâÄÊúâËõãÈÉΩÊâæÈΩä‰∫ÜÔºÅ\nÊ∫ñÂÇôÂ•ΩËøéÊé•È©öÂñú‰∫ÜÂóéÔºü" 
                : "ÁõÆÂâçËíêÈõÜÁöÑËÄÄË•øËõãÈÄ≤Â∫¶„ÄÇ\nË´ãÊéÉÊèèÂØ¶È´îÂç°Áâá‰æÜÁé©ÈÅäÊà≤ÔºÅ";
            eggDisplay.classList.remove('hidden');
            
            if (checkAllClear()) {
                uiBtn.innerText = "ÊâìÈñãÈ©öÂñú";
                uiBtn.onclick = startCakeScene;
            } else {
                uiBtn.style.display = 'none'; // Êú™ÂÖ®Á†¥‰∏çÈ°ØÁ§∫ÊåâÈàï
            }
        }

        // È°ØÁ§∫ÈÅäÊà≤‰ªãÁ¥π
        function showGameIntro(id) {
            const titles = [
                "1. ËÄÄË•øË∑≥Ë∑≥", "2. Êé•ÂìàÂØÜÁìú", "3. ËàåÈ†≠ÊîªÊìä", 
                "4. Â≠µËõãÂ§ß‰ΩúÊà∞", "5. È°èËâ≤ÂàÜÈ°û", "6. Ë∫≤ÈÅøÂ∫´Â∑¥"
            ];
            const descs = [
                "ÈªûÊìäËû¢ÂπïË∑≥Ë∫çÔºå\nÈÅøÈñãÈöúÁ§ôÁâ©Â†ÖÊåÅ15ÁßíÔºÅ",
                "Â∑¶Âè≥ÊªëÂãïÊé•ÂìàÂØÜÁìú(Á∂†Ëâ≤)Ôºå\nÈÅøÈñãÁÇ∏ÂΩà(ÈªëËâ≤)ÔºÅÊé•10ÂÄã„ÄÇ",
                "ÁúãÂà∞Á¥ÖËâ≤ÂòøËç∑Âá∫ÁèæÊôÇÔºå\nÈªûÊìäÂÆÉÊîªÊìäÔºÅÊäì8Èöª„ÄÇ",
                "5ÁßíÂÖßÂø´ÈÄüÈÄ£ÈªûËû¢Âπï20Ê¨°Ôºå\nËÆìËõãÂ≠µÂåñÔºÅ",
                "Á¥ÖËâ≤ËÄÄË•øÂæÄÂ∑¶Êªë(Á¥ÖÁ±É)Ôºå\nÁ∂†Ëâ≤ËÄÄË•øÂæÄÂè≥Êªë(Á∂†Á±É)„ÄÇÂàÜÂ∞ç10Èöª„ÄÇ",
                "Êåâ‰ΩèËû¢ÂπïÂâçÈÄ≤Ôºå\nÂ∫´Â∑¥ËΩâË∫´(ËÆäÁ¥Ö)ÊôÇÁ´ãÂàªÊîæÊâãÔºÅ"
            ];

            uiTitle.innerText = titles[id-1];
            uiDesc.innerText = descs[id-1];
            uiBtn.innerText = "ÈñãÂßãÈÅäÊà≤";
            uiBtn.onclick = () => startGame(id);
        }

        function gameWin() {
            cancelAnimationFrame(gameLoopId);
            isGameOver = true;
            localStorage.setItem('yoshi_game_' + gameId, 'true');
            
            uiLayer.classList.remove('hidden');
            uiTitle.innerText = "ÈÅéÈóúÔºÅ";
            uiDesc.innerText = "‰Ω†Áç≤Âæó‰∫Ü‰∏ÄÈ°ÜËÄÄË•øËõãÔºÅ";
            uiBtn.innerText = "ÂõûÂà∞ÈÄ≤Â∫¶Ë°®";
            uiBtn.onclick = () => { window.location.href = window.location.pathname; }; // ÂõûÂà∞ÁÑ°ÂèÉÊï∏È¶ñÈ†Å
        }

        function gameFail() {
            cancelAnimationFrame(gameLoopId);
            isGameOver = true;
            uiLayer.classList.remove('hidden');
            uiTitle.innerText = "Â§±Êïó‰∫Ü...";
            uiDesc.innerText = "ÂÜçË©¶‰∏ÄÊ¨°ÂêßÔºÅ";
            uiBtn.innerText = "Èáç‰æÜ";
            uiBtn.onclick = () => startGame(gameId);
        }

        function startGame(id) {
            uiLayer.classList.add('hidden');
            canvas.innerHTML = ''; // Ê∏ÖÁ©∫Áï´Â∏É
            isGameOver = false;
            score = 0;

            // Ê†πÊìö ID ÂïüÂãïÂ∞çÊáâÈÇèËºØ
            if(id === 1) startJumpGame();
            if(id === 2) startCatchGame();
            if(id === 3) startTongueGame();
            if(id === 4) startClickGame();
            if(id === 5) startSwipeGame();
            if(id === 6) startStopGame();
        }

        // --- Â∞èÈÅäÊà≤ 1: Ë∑≥Ë∫ç ---
        function startJumpGame() {
            const yoshi = createYoshi(50, 200);
            const ground = document.createElement('div');
            ground.className = 'ground';
            canvas.appendChild(ground);

            let dy = 0;
            let y = 0;
            let onGround = true;
            let timer = 0;
            const targetTime = 15 * 60; // 60fps * 15s

            // ÈªûÊìäË∑≥Ë∫ç
            document.body.ontouchstart = document.body.onmousedown = () => {
                if(onGround) { dy = -12; onGround = false; }
            };

            // ÈöúÁ§ôÁâ©ÁîüÊàê
            let obstacles = [];
            
            function loop() {
                if(isGameOver) return;
                timer++;
                
                // Áâ©ÁêÜ
                dy += 0.6; // ÈáçÂäõ
                y += dy;
                if(y > 0) { y = 0; dy = 0; onGround = true; }
                yoshi.style.bottom = (20 + -y) + 'px';

                // ÁîüÊàêÈöúÁ§ô
                if(timer % 120 === 0) {
                    const obs = document.createElement('div');
                    obs.className = 'obstacle game-object';
                    obs.style.left = '100%';
                    canvas.appendChild(obs);
                    obstacles.push({el: obs, x: 100});
                }

                // ÁßªÂãïÈöúÁ§ôËàáÁ¢∞Êíû
                obstacles.forEach((ob, index) => {
                    ob.x -= 1.5; // ÈÄüÂ∫¶
                    ob.el.style.left = ob.x + '%';
                    
                    // Á¢∞ÊíûÊ™¢Ê∏¨ (Á∞°ÂñÆÁâà)
                    if(ob.x < 20 && ob.x > 10 && y > -30) {
                        gameFail();
                    }
                    if(ob.x < -10) {
                        ob.el.remove();
                        obstacles.splice(index, 1);
                    }
                });

                // ÈÄöÈóú
                if(timer > targetTime) gameWin();
                else {
                   uiTitle.innerText = "Ââ©È§òÊôÇÈñì: " + Math.ceil((targetTime - timer)/60); // ÂÄüÁî®‰∏Ä‰∏ãÈö±ËóèÁöÑÊ®ôÈ°åÈ°ØÁ§∫ÂÄíÊï∏(Â¶ÇÊûúÊòØdebugÁî®)
                   gameLoopId = requestAnimationFrame(loop);
                }
            }
            loop();
        }

        // --- Â∞èÈÅäÊà≤ 2: Êé•ÂìàÂØÜÁìú ---
        function startCatchGame() {
            const yoshi = createYoshi(50, 20);
            let playerX = 50;
            let items = [];

            // ÊªëÂãïÊéßÂà∂
            let startX = 0;
            document.body.ontouchstart = (e) => startX = e.touches[0].clientX;
            document.body.ontouchmove = (e) => {
                let diff = e.touches[0].clientX - startX;
                playerX += diff * 0.1;
                if(playerX < 0) playerX = 0;
                if(playerX > 90) playerX = 90;
                yoshi.style.left = playerX + '%';
                startX = e.touches[0].clientX;
            };

            function loop() {
                if(isGameOver) return;
                
                // ÁîüÊàêÁâ©ÂìÅ
                if(Math.random() < 0.03) {
                    const isBomb = Math.random() < 0.3;
                    const item = document.createElement('div');
                    item.className = isBomb ? 'bomb game-object' : 'melon game-object';
                    item.style.left = Math.random() * 90 + '%';
                    item.style.top = '0px';
                    canvas.appendChild(item);
                    items.push({el: item, y: 0, type: isBomb ? 'bomb' : 'melon'});
                }

                items.forEach((it, i) => {
                    it.y += 2;
                    it.el.style.top = it.y + 'px';
                    
                    // Á¢∞Êíû
                    const playerRect = yoshi.getBoundingClientRect();
                    const itemRect = it.el.getBoundingClientRect();
                    
                    if(!(playerRect.right < itemRect.left || 
                         playerRect.left > itemRect.right || 
                         playerRect.bottom < itemRect.top || 
                         playerRect.top > itemRect.bottom)) {
                         
                         // ÊíûÂà∞‰∫Ü
                         it.el.remove();
                         items.splice(i, 1);
                         if(it.type === 'bomb') gameFail();
                         else {
                             score++;
                             if(score >= 10) gameWin();
                         }
                    }
                    else if(it.y > window.innerHeight) {
                        it.el.remove();
                        items.splice(i, 1);
                    }
                });
                gameLoopId = requestAnimationFrame(loop);
            }
            loop();
        }

        // --- Â∞èÈÅäÊà≤ 3: ËàåÈ†≠ÊîªÊìä ---
        function startTongueGame() {
            const yoshi = createYoshi(50, 20);
            yoshi.style.bottom = '20px';
            
            function spawnShyGuy() {
                if(isGameOver) return;
                const sg = document.createElement('div');
                sg.className = 'shy-guy game-object';
                sg.style.left = Math.random() * 80 + 10 + '%';
                sg.style.top = Math.random() * 60 + 10 + '%';
                
                sg.onmousedown = sg.ontouchstart = (e) => {
                    e.stopPropagation(); // Èò≤Ê≠¢ÈªûÂà∞ËÉåÊôØ
                    shootTongue(sg);
                };
                
                canvas.appendChild(sg);
                
                // 2ÁßíÊ≤íÈªûÂà∞Â∞±Ê∂àÂ§±
                setTimeout(() => { 
                    if(sg.parentNode) sg.remove(); 
                    if(!isGameOver) spawnShyGuy();
                }, 1500);
            }

            function shootTongue(target) {
                const tongue = document.createElement('div');
                tongue.className = 'tongue';
                
                // Ë®àÁÆóËàåÈ†≠Èï∑Â∫¶ËàáËßíÂ∫¶ (Á∞°ÂåñÁÇ∫Áõ¥Á∑öÂãïÁï´)
                const yRect = yoshi.getBoundingClientRect();
                const tRect = target.getBoundingClientRect();
                
                tongue.style.left = (yoshi.offsetLeft + 30) + 'px';
                tongue.style.top = (yoshi.offsetTop + 10) + 'px';
                
                // Á∞°ÂñÆË¶ñË¶∫ÊïàÊûúÔºå‰∏çË®àÁÆóÁúüÂØ¶‰∏âËßíÂáΩÊï∏ËßíÂ∫¶ÔºåÁõ¥Êé•ÊääËàåÈ†≠‰º∏ÈÅéÂéªÊòØÊØîËºÉË§áÈõúÁöÑ
                // ÈÄôË£°Á∞°ÂåñÔºöÈªûÂà∞Â∞±Ê∂àÊªÖÔºåÂä†ÂàÜ
                target.remove();
                score++;
                if(score >= 8) gameWin();
            }
            
            spawnShyGuy();
        }

        // --- Â∞èÈÅäÊà≤ 4: Â≠µËõã ---
        function startClickGame() {
            const egg = document.createElement('div');
            egg.className = 'big-egg';
            egg.style.position = 'absolute';
            egg.style.top = '50%';
            egg.style.left = '50%';
            egg.style.transform = 'translate(-50%, -50%) scale(1)';
            canvas.appendChild(egg);

            let clicks = 0;
            let timeLeft = 5;

            egg.onmousedown = egg.ontouchstart = (e) => {
                e.preventDefault();
                clicks++;
                egg.style.transform = `translate(-50%, -50%) scale(${1 + clicks/20})`;
                if(clicks >= 20) gameWin();
            };

            const timer = setInterval(() => {
                if(isGameOver) { clearInterval(timer); return; }
                timeLeft--;
                if(timeLeft <= 0) {
                    clearInterval(timer);
                    if(clicks < 20) gameFail();
                }
            }, 1000);
        }

        // --- Â∞èÈÅäÊà≤ 5: È°èËâ≤ÂàÜÈ°û ---
        function startSwipeGame() {
            const leftBasket = document.createElement('div');
            leftBasket.className = 'basket basket-left';
            leftBasket.innerText = 'Á¥ÖËâ≤';
            canvas.appendChild(leftBasket);

            const rightBasket = document.createElement('div');
            rightBasket.className = 'basket basket-right';
            rightBasket.innerText = 'Á∂†Ëâ≤';
            canvas.appendChild(rightBasket);

            let currentYoshi = null;
            let currentType = ''; // 'red' or 'green'
            
            function spawn() {
                if(isGameOver) return;
                currentType = Math.random() > 0.5 ? 'red' : 'green';
                currentYoshi = createYoshi(50, 50);
                currentYoshi.style.top = '100px';
                
                // ÊîπËÆäÈ°èËâ≤
                if(currentType === 'red') {
                    currentYoshi.querySelector('.yoshi-head').style.background = '#F44336';
                    currentYoshi.querySelector('.yoshi-body').style.background = '#F44336';
                    currentYoshi.querySelector('.yoshi-nose').style.background = '#F44336';
                }
            }

            // ÊªëÂãïÂÅµÊ∏¨
            let startX = 0;
            document.body.ontouchstart = (e) => startX = e.touches[0].clientX;
            document.body.ontouchend = (e) => {
                if(!currentYoshi) return;
                let endX = e.changedTouches[0].clientX;
                let diff = endX - startX;
                
                if(Math.abs(diff) > 50) {
                    if(diff < 0) { // Â∑¶Êªë
                        if(currentType === 'red') correct();
                        else gameFail();
                    } else { // Âè≥Êªë
                        if(currentType === 'green') correct();
                        else gameFail();
                    }
                }
            };

            function correct() {
                score++;
                currentYoshi.remove();
                currentYoshi = null;
                if(score >= 10) gameWin();
                else setTimeout(spawn, 300);
            }

            spawn();
        }

        // --- Â∞èÈÅäÊà≤ 6: Ë∫≤ÈÅøÂ∫´Â∑¥ ---
        function startStopGame() {
            const yoshi = createYoshi(50, 80);
            yoshi.style.bottom = '10px';
            yoshi.style.left = '10px';
            
            const bowser = document.createElement('div');
            bowser.className = 'bowser';
            canvas.appendChild(bowser);
            
            const finishLine = document.createElement('div');
            finishLine.style.position = 'absolute';
            finishLine.style.top = '100px';
            finishLine.style.width = '100%';
            finishLine.style.borderTop = '5px dashed white';
            canvas.appendChild(finishLine);

            let progress = 10;
            let isMoving = false;
            let bowserAngry = false;
            let bowserTimer = 0;

            document.body.ontouchstart = () => isMoving = true;
            document.body.ontouchend = () => isMoving = false;

            function loop() {
                if(isGameOver) return;
                
                // Â∫´Â∑¥ÈÇèËºØ
                bowserTimer++;
                if(bowserTimer % 150 === 0) {
                    bowserAngry = !bowserAngry;
                    bowser.classList.toggle('angry', bowserAngry);
                    // Â∫´Â∑¥ËΩâË∫´ÊôÇÈáçÁΩÆ timer Èö®Ê©ü‰∏ÄÈªû
                    bowserTimer = Math.floor(Math.random() * 50); 
                }

                // Áé©ÂÆ∂ÁßªÂãï
                if(isMoving) {
                    if(bowserAngry) {
                        gameFail();
                        return;
                    }
                    progress += 0.5;
                    yoshi.style.bottom = progress + '%';
                }

                if(progress >= 80) gameWin();
                else gameLoopId = requestAnimationFrame(loop);
            }
            loop();
        }

        // --- ËºîÂä©ÔºöÂª∫Á´ãËÄÄË•ø DOM ---
        function createYoshi(x, y) {
            const el = document.createElement('div');
            el.className = 'yoshi';
            el.innerHTML = `
                <div class="yoshi-head"></div>
                <div class="yoshi-nose"></div>
                <div class="yoshi-body"></div>
                <div class="yoshi-cheek"></div>
                <div class="yoshi-shell"></div>
                <div class="yoshi-boots"></div>
            `;
            // Â¶ÇÊûú x, y ÊòØÁôæÂàÜÊØîÊàñ px
            if(x) el.style.left = x + '%';
            if(y) el.style.top = y + 'px';
            canvas.appendChild(el);
            return el;
        }

        // --- ÊúÄÁµÇÈ©öÂñúÔºöËõãÁ≥ïÂãïÁï´ ---
        function startCakeScene() {
            document.getElementById('game-container').innerHTML = `
                <div id="cake-scene" style="width:100%; height:100%;">
                    <div class="cake-container">
                        <div class="candle"><div class="flame"></div></div>
                        <div class="cake-base">
                            <div class="cake-spot" style="top:20px; left:20px;"></div>
                            <div class="cake-spot" style="top:50px; left:80px;"></div>
                            <div class="cake-spot" style="top:10px; right:30px;"></div>
                        </div>
                    </div>
                    <div class="message-jp">
                        ÈòøÁô±<br>
                        „ÅäË™ïÁîüÊó•„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅ
                    </div>
                </div>
            `;
            
            // Á∞°ÊòìÁöÑ CSS ÂΩ©Â∏∂ÊïàÊûú (Áõ¥Êé•Áî® JS ÁîüÊàê DOM)
            for(let i=0; i<50; i++) {
                let conf = document.createElement('div');
                conf.style.position = 'absolute';
                conf.style.width = '10px';
                conf.style.height = '10px';
                conf.style.background = ['#FFC107', '#2196F3', '#F44336', '#4CAF50'][Math.floor(Math.random()*4)];
                conf.style.left = Math.random() * 100 + '%';
                conf.style.top = -10 + 'px';
                conf.style.transition = `top ${Math.random()*2+2}s ease-in, transform 2s linear`;
                document.getElementById('cake-scene').appendChild(conf);
                
                setTimeout(() => {
                    conf.style.top = '110%';
                    conf.style.transform = `rotate(${Math.random()*360}deg)`;
                }, 100);
            }
        }

        // ÂïüÂãï
        init();

    </script>
</body>
</html>